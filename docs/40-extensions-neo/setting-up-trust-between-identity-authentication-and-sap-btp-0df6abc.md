<!-- loio0df6abc18397483dbb34b87dcc0622c7 -->

# Setting Up Trust Between Identity Authentication and SAP BTP

Use this procedure to configure the SAP BTP trust settings and to add the tenant of Identity Authentication registered for your current SAP user as an identity provider.



## Context

> ### Remember:  
> SAP Business Technology Platform, Neo environment will sunset on **December 31, 2028**, subject to terms of customer or partner contracts.
> 
> For more information, see SAP Note [3351844](https://me.sap.com/notes/3351844).

> ### Tip:  
> **This documentation refers to SAP Business Technology Platform, Neo environment. If you are looking for documentation about other environments, see [SAP Business Technology Platform](https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/6a2c1ab5a31b4ed9a2ce17a5329e1dd8.html "SAP Business Technology Platform (SAP BTP) is an integrated offering comprised of the following technology portfolios: application development; process automation; integration; data, analytics, and enterprise planning; artificial intelligence. The platform offers users the ability to turn data into business value, compose end-to-end business processes, connect entire IT landscapes, and personalize, build and extend SAP applications. This reduces the overall total cost of ownership maintaining SAP landscapes and third-party software across end-to-end business processes.") :arrow_upper_right:.**

Identity Authentication is closely integrated with SAP BTP, and it is offered as part of most of the cloud platform packages. For those packages the trust between the subaccount in SAP BTP and Identity Authentication is configured automatically and the tenant for Identity Authentication is set up by default, once you have a partner or customer subaccount. However, you can manually configure the trust and set up the Identity Authentication tenant if your scenario requires it.



## Procedure

1.  Open the SAP BTP cockpit, select the region in which your subaccount is hosted, then select the global account that contains your subaccount, and then choose the tile of your subaccount. For more information about the regions, see [Regions and Hosts](https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/350356d1dc314d3199dca15bd2ab9b0e.html).

2.  Choose *Security* \> *Trust* in the navigation.

3.  Choose the *Local Service Provider* tab, and then choose *Edit*.

4.  From the *Configuration Type* dropdown box, select *Custom*.

5.  Configure the signing key and the signing certificate as follows:

    -   If you want to use a signing key and a self-signed certificate automatically generated by the system, choose *Generate Key Pair*.
    -   If you have your own key and certificate generated from an external application and signed by a trusted CA\), you can use them instead of using the ones generated by the SAP BTP. To do so, copy the Base64-encoded signing key in the *Signing Key* field, and then copy the textual content of the certificate in the *Signing Certificate* field.

6.  From the *Principal Propagation* dropdown box, select *Enabled*. Thus, you enable the propagation of the principal ID in the OAuth destination and hence, the application-to-application Single Sign-On \(SSO\).

7.  Choose *Save*.

8.  Choose the *Get Metadata* link to download the SAP BTP metadata for your subaccount. You will need this metadata in **Step 17**.

9.  Save the metadata of your Identity Authentication tenant on your local file system as an XML file. You can find the tenant at <code>https://<i class="varname">&lt;tenant ID&gt;</i>.accounts.ondemand.com/saml2/metadata</code>. You will need this metadata in **Step 10**.

10. Go to SAP BTP cockpit and choose *Security* \> *Trust* \> *Application Identity Provider*. Then choose *Add Trusted Identity Provider*. In the *General* tab, upload the Identity Authentication metadata XML file \(from **Step 9**\) in the *Metadata File* field.

11. In the *Attributes* tab, choose *Add Assertion-Based Attribute* to add the following attribute mappings \(after adding one pair, choose *Add Assertion-Based Attribute* again to add more input fields\).


    <table>
    <tr>
    <th valign="top">

    Assertion Attribute
    
    </th>
    <th valign="top">

    Principle Attribute
    
    </th>
    </tr>
    <tr>
    <td valign="top">
    
    first\_name
    
    </td>
    <td valign="top">
    
    firstname
    
    </td>
    </tr>
    <tr>
    <td valign="top">
    
    last\_name
    
    </td>
    <td valign="top">
    
    lastname
    
    </td>
    </tr>
    <tr>
    <td valign="top">
    
    mail
    
    </td>
    <td valign="top">
    
    email
    
    </td>
    </tr>
    </table>
    
12. Choose *Save*.

13. Access the tenant's administration console for Identity Authentication by using the console's URL.

    The URL has the <code>https://<i class="varname">&lt;tenant ID&gt;</i>.accounts.ondemand.com/admin</code> pattern.

    You can also get the URL from the Identity Authentication tenant registration e-mail.

14. Choose the *Applications & Resources* \> *Applications*.

15. Choose the *\+Add* button on the left hand panel, and enter the name of your subaccount in SAP BTP.

16. Choose *Save*.

17. Configure the SAML 2.0 trust with your subaccount in SAP BTP as a service provider. To do so, proceed as follows:

    1.  On the left-hand side, choose the newly created application, and then choose *Trust*.

    2.  Choose *SAML 2.0 Configuration*.

    3.  Upload the metadata XML file of your subaccount in SAP BTP that you have downloaded in **Step 8**.

        On service provider metadata upload, the fields are populated with the parsed data from the XML file.

    4.  Save the configuration settings.


18. Configure the identity federation on Identity Authentication. To do so, proceed as follows:

    1.  You are still in the tenant's administration console for Identity Authentication, choose *Name ID Attribute* and then select *Login Name*.

        This is the profile attribute that Identity Authentication sends to the application as a name ID. The application then uses this attribute to identify the user.

    2.  Save your selection.





## Results

The trust will be established automatically upon registration on both the SAP BTP and Identity Authentication tenant side.

**Related Information**  


[Get Started with Identity Authentication](https://help.sap.com/viewer/6d6d63354d1242d185ab4830fc04feb1/Cloud/en-US/31af7da133874e199a7df1d42905241b.html)

[ID Federation with a Identity Authentication Tenant](https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/d3df5b457d0c43fca117da0dc14e2f0d.html)

